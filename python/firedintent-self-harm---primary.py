# A. John, A. Marchant, 2024.

import sys, csv, re

codes = [{"code":"U271.","system":"readv2"},{"code":"U276.","system":"readv2"},{"code":"U27y.","system":"readv2"},{"code":"TKx1.","system":"readv2"},{"code":"U270.","system":"readv2"},{"code":"U274.","system":"readv2"},{"code":"U273.","system":"readv2"},{"code":"U275.","system":"readv2"},{"code":"U272.","system":"readv2"},{"code":"U277.","system":"readv2"},{"code":"U27..","system":"readv2"},{"code":"U27z.","system":"readv2"},{"code":"U72..","system":"readv2"},{"code":"X76.7","system":"readv2"},{"code":"X76","system":"readv2"},{"code":"X76.5","system":"readv2"},{"code":"X76.1","system":"readv2"},{"code":"X76.2","system":"readv2"},{"code":"X76.0","system":"readv2"},{"code":"X76.9","system":"readv2"},{"code":"X76.3","system":"readv2"},{"code":"X76.8","system":"readv2"},{"code":"X76.4","system":"readv2"},{"code":"X76.6","system":"readv2"},{"code":"U45y.","system":"readv2"},{"code":"U44z.","system":"readv2"},{"code":"U445.","system":"readv2"},{"code":"U4B6.","system":"readv2"},{"code":"U440.","system":"readv2"},{"code":"U4B..","system":"readv2"},{"code":"U4B2.","system":"readv2"},{"code":"U416.","system":"readv2"},{"code":"U411.","system":"readv2"},{"code":"U417.","system":"readv2"},{"code":"U4B0.","system":"readv2"},{"code":"U444.","system":"readv2"},{"code":"U410.","system":"readv2"},{"code":"U4B3.","system":"readv2"},{"code":"U457.","system":"readv2"},{"code":"U452.","system":"readv2"},{"code":"U44..","system":"readv2"},{"code":"U4B1.","system":"readv2"},{"code":"U450.","system":"readv2"},{"code":"U451.","system":"readv2"},{"code":"U446.","system":"readv2"},{"code":"U44y.","system":"readv2"},{"code":"U453.","system":"readv2"},{"code":"U41z.","system":"readv2"},{"code":"U4B4.","system":"readv2"},{"code":"U45z.","system":"readv2"},{"code":"U41y.","system":"readv2"},{"code":"U414.","system":"readv2"},{"code":"U412.","system":"readv2"},{"code":"U415.","system":"readv2"},{"code":"U4B7.","system":"readv2"},{"code":"U4Bz.","system":"readv2"},{"code":"U41..","system":"readv2"},{"code":"U4B5.","system":"readv2"},{"code":"U442.","system":"readv2"},{"code":"U45..","system":"readv2"},{"code":"U454.","system":"readv2"},{"code":"U447.","system":"readv2"},{"code":"U4By.","system":"readv2"},{"code":"U455.","system":"readv2"},{"code":"U441.","system":"readv2"},{"code":"U413.","system":"readv2"},{"code":"U456.","system":"readv2"},{"code":"U443.","system":"readv2"},{"code":"Y14.6","system":"readv2"},{"code":"Y14.8","system":"readv2"},{"code":"Y24.9","system":"readv2"},{"code":"Y24.7","system":"readv2"},{"code":"Y16.3","system":"readv2"},{"code":"Y23.9","system":"readv2"},{"code":"Y33.7","system":"readv2"},{"code":"Y25.6","system":"readv2"},{"code":"Y26.3","system":"readv2"},{"code":"Y26","system":"readv2"},{"code":"Y26.2","system":"readv2"},{"code":"Y22.2","system":"readv2"},{"code":"Y13.1","system":"readv2"},{"code":"Y21.5","system":"readv2"},{"code":"Y18.1","system":"readv2"},{"code":"Y13.7","system":"readv2"},{"code":"Y31.1","system":"readv2"},{"code":"Y14","system":"readv2"},{"code":"Y10","system":"readv2"},{"code":"Y10.8","system":"readv2"},{"code":"Y20.6","system":"readv2"},{"code":"Y10.2","system":"readv2"},{"code":"Y17.7","system":"readv2"},{"code":"Y29.4","system":"readv2"},{"code":"Y17.9","system":"readv2"},{"code":"Y34.8","system":"readv2"},{"code":"Y25.9","system":"readv2"},{"code":"Y23.5","system":"readv2"},{"code":"Y24","system":"readv2"},{"code":"Y34.0","system":"readv2"},{"code":"Y29.6","system":"readv2"},{"code":"Y11.8","system":"readv2"},{"code":"Y31.7","system":"readv2"},{"code":"Y29.7","system":"readv2"},{"code":"Y32","system":"readv2"},{"code":"Y21.9","system":"readv2"},{"code":"Y27.6","system":"readv2"},{"code":"Y24.3","system":"readv2"},{"code":"Y34.9","system":"readv2"},{"code":"Y34.7","system":"readv2"},{"code":"Y27.1","system":"readv2"},{"code":"Y10.7","system":"readv2"},{"code":"Y31.9","system":"readv2"},{"code":"Y33.6","system":"readv2"},{"code":"Y17.6","system":"readv2"},{"code":"Y26.5","system":"readv2"},{"code":"Y12.3","system":"readv2"},{"code":"Y10.9","system":"readv2"},{"code":"Y24.2","system":"readv2"},{"code":"Y18.6","system":"readv2"},{"code":"Y16.1","system":"readv2"},{"code":"Y13.3","system":"readv2"},{"code":"Y12.2","system":"readv2"},{"code":"Y32.2","system":"readv2"},{"code":"Y30.0","system":"readv2"},{"code":"Y28.2","system":"readv2"},{"code":"Y31.3","system":"readv2"},{"code":"Y32.8","system":"readv2"},{"code":"Y16.7","system":"readv2"},{"code":"Y17.8","system":"readv2"},{"code":"Y20.8","system":"readv2"},{"code":"Y18.5","system":"readv2"},{"code":"Y28.6","system":"readv2"},{"code":"Y12.9","system":"readv2"},{"code":"Y10.4","system":"readv2"},{"code":"Y24.4","system":"readv2"},{"code":"Y17.0","system":"readv2"},{"code":"Y13.8","system":"readv2"},{"code":"Y33","system":"readv2"},{"code":"Y22.3","system":"readv2"},{"code":"Y25.2","system":"readv2"},{"code":"Y24.8","system":"readv2"},{"code":"Y20.5","system":"readv2"},{"code":"Y26.1","system":"readv2"},{"code":"Y22.0","system":"readv2"},{"code":"Y25.5","system":"readv2"},{"code":"Y21.3","system":"readv2"},{"code":"Y14.1","system":"readv2"},{"code":"Y24.0","system":"readv2"},{"code":"Y12.5","system":"readv2"},{"code":"Y33.3","system":"readv2"},{"code":"Y11.0","system":"readv2"},{"code":"Y33.4","system":"readv2"},{"code":"Y17.2","system":"readv2"},{"code":"Y18.7","system":"readv2"},{"code":"Y12.4","system":"readv2"},{"code":"Y23.7","system":"readv2"},{"code":"Y26.6","system":"readv2"},{"code":"Y20.0","system":"readv2"},{"code":"Y20","system":"readv2"},{"code":"Y22.5","system":"readv2"},{"code":"Y19","system":"readv2"},{"code":"Y10.3","system":"readv2"},{"code":"Y10.1","system":"readv2"},{"code":"Y29.2","system":"readv2"},{"code":"Y28.5","system":"readv2"},{"code":"Y25","system":"readv2"},{"code":"Y11.4","system":"readv2"},{"code":"Y31","system":"readv2"},{"code":"Y25.8","system":"readv2"},{"code":"Y20.2","system":"readv2"},{"code":"Y18.0","system":"readv2"},{"code":"Y16","system":"readv2"},{"code":"Y29.1","system":"readv2"},{"code":"Y23.1","system":"readv2"},{"code":"Y12.0","system":"readv2"},{"code":"Y34.4","system":"readv2"},{"code":"Y28.4","system":"readv2"},{"code":"Y25.3","system":"readv2"},{"code":"Y34.6","system":"readv2"},{"code":"Y21.2","system":"readv2"},{"code":"Y20.7","system":"readv2"},{"code":"Y11.3","system":"readv2"},{"code":"Y18.2","system":"readv2"},{"code":"Y34","system":"readv2"},{"code":"Y10.0","system":"readv2"},{"code":"Y26.7","system":"readv2"},{"code":"Y22.8","system":"readv2"},{"code":"Y12.7","system":"readv2"},{"code":"Y32.0","system":"readv2"},{"code":"Y19.7","system":"readv2"},{"code":"Y14.4","system":"readv2"},{"code":"Y29.5","system":"readv2"},{"code":"Y14.0","system":"readv2"},{"code":"Y34.3","system":"readv2"},{"code":"Y28.7","system":"readv2"},{"code":"Y29.9","system":"readv2"},{"code":"Y20.4","system":"readv2"},{"code":"Y29.0","system":"readv2"},{"code":"Y33.2","system":"readv2"},{"code":"Y18.3","system":"readv2"},{"code":"Y28.3","system":"readv2"},{"code":"Y32.7","system":"readv2"},{"code":"Y21.0","system":"readv2"},{"code":"Y18.9","system":"readv2"},{"code":"Y27.7","system":"readv2"},{"code":"Y31.5","system":"readv2"},{"code":"Y32.1","system":"readv2"},{"code":"Y33.9","system":"readv2"},{"code":"Y30.4","system":"readv2"},{"code":"Y22.7","system":"readv2"},{"code":"Y29.8","system":"readv2"},{"code":"Y22.1","system":"readv2"},{"code":"Y21.4","system":"readv2"},{"code":"Y28.8","system":"readv2"},{"code":"Y34.1","system":"readv2"},{"code":"Y19.1","system":"readv2"},{"code":"Y14.7","system":"readv2"},{"code":"Y21","system":"readv2"},{"code":"Y28.9","system":"readv2"},{"code":"Y30.3","system":"readv2"},{"code":"Y21.6","system":"readv2"},{"code":"Y32.9","system":"readv2"},{"code":"Y27.8","system":"readv2"},{"code":"Y11.9","system":"readv2"},{"code":"Y24.1","system":"readv2"},{"code":"Y19.3","system":"readv2"},{"code":"Y28","system":"readv2"},{"code":"Y21.8","system":"readv2"},{"code":"Y13","system":"readv2"},{"code":"Y30.9","system":"readv2"},{"code":"Y13.0","system":"readv2"},{"code":"Y23","system":"readv2"},{"code":"Y31.6","system":"readv2"},{"code":"Y27.2","system":"readv2"},{"code":"Y11.2","system":"readv2"},{"code":"Y30.8","system":"readv2"},{"code":"Y11.7","system":"readv2"},{"code":"Y33.1","system":"readv2"},{"code":"Y30.6","system":"readv2"},{"code":"Y18.4","system":"readv2"},{"code":"Y23.3","system":"readv2"},{"code":"Y10.6","system":"readv2"},{"code":"Y30.5","system":"readv2"},{"code":"Y17.4","system":"readv2"},{"code":"Y25.4","system":"readv2"},{"code":"Y21.1","system":"readv2"},{"code":"Y12.1","system":"readv2"},{"code":"Y32.5","system":"readv2"},{"code":"Y28.0","system":"readv2"},{"code":"Y23.6","system":"readv2"},{"code":"Y16.9","system":"readv2"},{"code":"Y32.6","system":"readv2"},{"code":"Y11.6","system":"readv2"},{"code":"Y12","system":"readv2"},{"code":"Y87.2","system":"readv2"},{"code":"Y11.5","system":"readv2"},{"code":"Y14.3","system":"readv2"},{"code":"Y34.2","system":"readv2"},{"code":"Y12.8","system":"readv2"},{"code":"Y23.8","system":"readv2"},{"code":"Y17.5","system":"readv2"},{"code":"Y19.2","system":"readv2"},{"code":"Y27.4","system":"readv2"},{"code":"Y20.1","system":"readv2"},{"code":"Y26.0","system":"readv2"},{"code":"Y19.6","system":"readv2"},{"code":"Y26.8","system":"readv2"},{"code":"Y25.0","system":"readv2"},{"code":"Y14.5","system":"readv2"},{"code":"Y13.2","system":"readv2"},{"code":"Y22","system":"readv2"},{"code":"Y16.0","system":"readv2"},{"code":"Y23.0","system":"readv2"},{"code":"Y11","system":"readv2"},{"code":"Y33.5","system":"readv2"},{"code":"Y31.4","system":"readv2"},{"code":"Y19.4","system":"readv2"},{"code":"Y27","system":"readv2"},{"code":"Y17.3","system":"readv2"},{"code":"Y13.6","system":"readv2"},{"code":"Y30","system":"readv2"},{"code":"Y13.5","system":"readv2"},{"code":"Y16.6","system":"readv2"},{"code":"Y12.6","system":"readv2"},{"code":"Y32.4","system":"readv2"},{"code":"Y31.8","system":"readv2"},{"code":"Y31.2","system":"readv2"},{"code":"Y26.9","system":"readv2"},{"code":"Y23.2","system":"readv2"},{"code":"Y16.5","system":"readv2"},{"code":"Y27.5","system":"readv2"},{"code":"Y27.3","system":"readv2"},{"code":"Y22.9","system":"readv2"},{"code":"Y27.0","system":"readv2"},{"code":"Y24.6","system":"readv2"},{"code":"Y24.5","system":"readv2"},{"code":"Y13.4","system":"readv2"},{"code":"Y27.9","system":"readv2"},{"code":"Y20.3","system":"readv2"},{"code":"Y19.9","system":"readv2"},{"code":"Y16.8","system":"readv2"},{"code":"Y17.1","system":"readv2"},{"code":"Y34.5","system":"readv2"},{"code":"Y30.7","system":"readv2"},{"code":"Y30.1","system":"readv2"},{"code":"Y20.9","system":"readv2"},{"code":"Y22.4","system":"readv2"},{"code":"Y18.8","system":"readv2"},{"code":"Y21.7","system":"readv2"},{"code":"Y25.7","system":"readv2"},{"code":"Y32.3","system":"readv2"},{"code":"Y11.1","system":"readv2"},{"code":"Y30.2","system":"readv2"},{"code":"Y17","system":"readv2"},{"code":"Y31.0","system":"readv2"},{"code":"Y16.2","system":"readv2"},{"code":"Y18","system":"readv2"},{"code":"Y28.1","system":"readv2"},{"code":"Y14.9","system":"readv2"},{"code":"Y33.8","system":"readv2"},{"code":"Y22.6","system":"readv2"},{"code":"Y19.8","system":"readv2"},{"code":"Y16.4","system":"readv2"},{"code":"Y14.2","system":"readv2"},{"code":"Y33.0","system":"readv2"},{"code":"Y29.3","system":"readv2"},{"code":"Y29","system":"readv2"},{"code":"Y19.5","system":"readv2"},{"code":"Y10.5","system":"readv2"},{"code":"Y26.4","system":"readv2"},{"code":"Y25.1","system":"readv2"},{"code":"Y13.9","system":"readv2"},{"code":"Y19.0","system":"readv2"},{"code":"Y23.4","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('self-harm-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["firedintent-self-harm---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["firedintent-self-harm---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["firedintent-self-harm---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
